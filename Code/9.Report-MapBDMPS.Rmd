---
title: "`r inputs$title`"
author: "`r inputs$authors`"
date: "`r format(Sys.Date(), '%d %B %Y')`"
always_allow_html: yes
header-includes: 
 - \usepackage{longtable}
 - \usepackage{pdflscape}
 - \usepackage{float}
 - \usepackage{setspace}\onehalfspacing
 - \usepackage{indentfirst}
 - \usepackage{booktabs}
 - \usepackage{array}
 - \usepackage{multirow}
 - \usepackage{wrapfig}
 - \usepackage{colortbl}
 - \usepackage{tabu}
 - \usepackage{threeparttable}
 - \usepackage{threeparttablex}
 - \usepackage[normalem]{ulem}
 - \usepackage{makecell}
 - \usepackage{xcolor}
 - \usepackage{caption}
 - \floatplacement{figure}{H} 
output:
  pdf_document:
    citation_package: natbib
    highlight: tango
    latex_engine: lualatex
    df_print: kable
mainfont: Calibri
#monofont: Courier
fontsize: 12pt
geometry: margin=1in
linkcolor: blue
documentclass: article
citecolor: magenta
urlcolor: blue
params:
  date_format: '%d %m %Y'
---
```{r titleauthors, echo=FALSE}
knitr::opts_chunk$set(error=TRUE)

options(knitr.table.format = "latex")

#prints errors in red
knit_hooks$set(error= function (x, options) {
  x<-xfun:::split_lines(x)
  sprintf('\\color{red}  %s \\newline \\color{black}', x) })
```



<!-- Report for map mode BDMPS colonies -->


# Summary

This report presents the apportioning of `r inputs$longspecies` in the UK in the `r inputs$season` for the `r inputs$BDMPS.region` BDMPS region. The number of `r tolower(inputs$species)`s was estimated to be `r all.cols$cbirdout[nrow(all.cols)]`. The total bird density within the BDMPS region was estimated to be `r all.cols$cbirdkmout[nrow(all.cols)]` km$^{-2}$. In total, `r length(which(all.cols$source=="BDMPS"))` BDMPS colonies contributed to the apportioning calculations.


The accompanying User Guide to this tool describes the methods used to estimate bird metrics within the footprint. For this model run, only BDMPS is used to estimate apportioning and no levels of uncertainty are included in the estimates of apportioning. 



# User inputs

Table \ref{tab:inputs1} shows the user-defined inputs to the analysis.

```{r report-userinputs, warning=FALSE, echo=FALSE}

aa <- data.frame(
  desc=c("Species","Mode","BDMPS uncertainty scalar","Distance threshold (km)","Season","BDMPS Region"),
  param=c(inputs$species, inputs$mode, inputs$BDMPS.uncertainty, inputs$dist.thresh, inputs$season,inputs$BDMPS.region)
  
)

kable(aa, 
      col.names=c("Parameter description","Parameter value"),
      caption="\\label{tab:inputs1} Input parameter values for ANBS tool run", 
      longtable=TRUE, 
      row.names =FALSE, 
      booktabs = TRUE) %>%
  kable_styling(latex_options = c("HOLD_position", "repeat_header"))%>% 
  row_spec(0,bold=TRUE)

```


Table \ref{tab:inputs2} shows colonies that are defined from the BDMPS populations and the size (number of pairs of breeding adults) of each population, whether a UK SPA, aggregate of UK non-SPA colonies, or aggregate of overseas colonies. In the ANBS tool, the number of pairs of breeding adults can be changed for any colony as part of the inputs so the table shows the population estimates used in the analysis.

```{r report-userpop, warning=FALSE, echo=FALSE}

ab <- data.frame(inputs$Population,inputs$Pairs.est)

kable(ab, 
      col.names=c("Colony or population", "Estimated pairs of breeding adults"),
      caption="\\label{tab:inputs2} Input parameter values for ANBS tool run", 
      longtable=TRUE, 
      row.names =FALSE, 
      booktabs = T) %>%
  kable_styling(latex_options = c("HOLD_position", "repeat_header"))%>% 
  row_spec(0,bold=TRUE) %>%
  column_spec(column=2, width='1.5in')
```


# Results

## Apportioning tables

Table \ref{tab:app} shows the colonies and populations used in the apportioning calculations for the area of the `r inputs$BDMPS.region` BDMPS region. 


```{r report-apptable, warning=FALSE, echo=FALSE}

ac <- data.frame(all.cols[,c("Population","source","birdout","birdkmout","appout")])

kable(ac[,c(1,3:5)], 
      col.names=c("Colony or population", "Number of adults", "Adults per sq. km","Proportion of adults"),
      caption=paste0("\\label{tab:app} Colonies or populations used in the apportioning calculations, showing the number of adults, adults per sq. km, and proportion of adults from each BDMPS colony or population."), 
      longtable=TRUE, 
      row.names=FALSE,
      booktabs = T) %>%
  kable_styling(latex_options = c("HOLD_position", "repeat_header", "scale_down"))%>% 
  row_spec(0,bold=TRUE) %>%
  column_spec(column=1:4, width='1.5in')

```


Table \ref{tab:cumapp} shows the colonies and populations used in the cumulative apportioning calculations for the area of the `r inputs$BDMPS.region` BDMPS region. 


```{r report-cumapptable, warning=FALSE, echo=FALSE}

ad <- data.frame(all.cols[,c("Population","source","cbirdout","cbirdkmout","cappout")])

kable(ad[,c(1,3:5)], 
      col.names=c("Colony or population", "Cumulative number of adults", "Cumulative adults per sq. km", "Cumulative proportion of adults"),
      caption=paste0("\\label{tab:cumapp} Colonies or populations used in the apportioning calculations, showing the cumulative number of adults, cumulative adults per sq. km, and cumulative proportion of adults from each BDMPS colony or population."), 
      longtable=TRUE, 
      row.names=FALSE,
      booktabs = T) %>%
      kable_styling(latex_options = c("HOLD_position", "repeat_header", "scale_down"))%>% 
   row_spec(0,bold=TRUE)%>%
  column_spec(column=1:4, width='1.5in')

```




## RAG status

Fig. \ref{fig:ragmap} shows the BDMPS colonies that contribute to the final apportioning in the analysis (red circles). 


```{r report-ragmap, echo=FALSE, fig.cap="\\label{fig:ragmap} RAG status map showing colonies used in the analysis. Red = BDMPS", fig.height=6, fig.width=6}
include_graphics('colonymapRAG.png')
#colonymapRAG
```



# Caveats and limitations

-   Currently, only adult breeding birds are considered within the apportioning calculation. Immature birds and non-breeding adults are not considered in this iteration of the ANBS tool.


# Apppendix

## System information used in the analysis

The information below shows the system information used in the analysis including the version of R, platform, locale, and packages with version numbers.

```{r report-info, echo=FALSE}
pander(sessionInfo())
```



